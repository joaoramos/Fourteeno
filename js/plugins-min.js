/*
 * MBP - Mobile boilerplate helper functions
 */(function(a){function b(a,b,c,d){if("addEventListener"in a)try{a.addEventListener(b,c,d)}catch(e){if(typeof c!="object"||!c.handleEvent)throw e;a.addEventListener(b,function(a){c.handleEvent.call(c,a)},d)}else"attachEvent"in a&&(typeof c=="object"&&c.handleEvent?a.attachEvent("on"+b,function(){c.handleEvent.call(c)}):a.attachEvent("on"+b,c))}function c(a,b,c,d){if("removeEventListener"in a)try{a.removeEventListener(b,c,d)}catch(e){if(typeof c!="object"||!c.handleEvent)throw e;a.removeEventListener(b,function(a){c.handleEvent.call(c,a)},d)}else"detachEvent"in a&&(typeof c=="object"&&c.handleEvent?a.detachEvent("on"+b,function(){c.handleEvent.call(c)}):a.detachEvent("on"+b,c))}window.MBP=window.MBP||{};MBP.viewportmeta=a.querySelector&&a.querySelector('meta[name="viewport"]');MBP.ua=navigator.userAgent;MBP.scaleFix=function(){if(MBP.viewportmeta&&/iPhone|iPad|iPod/.test(MBP.ua)&&!/Opera Mini/.test(MBP.ua)){MBP.viewportmeta.content="width=device-width, minimum-scale=1.0, maximum-scale=1.0";a.addEventListener("gesturestart",MBP.gestureStart,!1)}};MBP.gestureStart=function(){MBP.viewportmeta.content="width=device-width, minimum-scale=0.25, maximum-scale=1.6"};MBP.BODY_SCROLL_TOP=!1;MBP.getScrollTop=function(){var b=window,c=a;return b.pageYOffset||c.compatMode==="CSS1Compat"&&c.documentElement.scrollTop||c.body.scrollTop||0};MBP.hideUrlBar=function(){var a=window;!location.hash&&MBP.BODY_SCROLL_TOP!==!1&&a.scrollTo(0,MBP.BODY_SCROLL_TOP===1?0:1)};MBP.hideUrlBarOnLoad=function(){var a=window,b=a.document;if(!location.hash&&a.addEventListener){window.scrollTo(0,1);MBP.BODY_SCROLL_TOP=1;bodycheck=setInterval(function(){if(b.body){clearInterval(bodycheck);MBP.BODY_SCROLL_TOP=MBP.getScrollTop();MBP.hideUrlBar()}},15);a.addEventListener("load",function(){setTimeout(function(){MBP.getScrollTop()<20&&MBP.hideUrlBar()},0)})}};MBP.fastButton=function(a,c){this.element=a;this.handler=c;b(a,"touchstart",this,!1);b(a,"click",this,!1)};MBP.fastButton.prototype.handleEvent=function(a){a=a||window.event;switch(a.type){case"touchstart":this.onTouchStart(a);break;case"touchmove":this.onTouchMove(a);break;case"touchend":this.onClick(a);break;case"click":this.onClick(a)}};MBP.fastButton.prototype.onTouchStart=function(b){b.stopPropagation();this.element.addEventListener("touchend",this,!1);a.body.addEventListener("touchmove",this,!1);this.startX=b.touches[0].clientX;this.startY=b.touches[0].clientY;this.element.style.backgroundColor="rgba(0,0,0,.7)"};MBP.fastButton.prototype.onTouchMove=function(a){(Math.abs(a.touches[0].clientX-this.startX)>10||Math.abs(a.touches[0].clientY-this.startY)>10)&&this.reset()};MBP.fastButton.prototype.onClick=function(a){a=a||window.event;a.stopPropagation&&a.stopPropagation();this.reset();this.handler(a);a.type=="touchend"&&MBP.preventGhostClick(this.startX,this.startY);this.element.style.backgroundColor=""};MBP.fastButton.prototype.reset=function(){c(this.element,"touchend",this,!1);c(a.body,"touchmove",this,!1);this.element.style.backgroundColor=""};MBP.preventGhostClick=function(a,b){MBP.coords.push(a,b);window.setTimeout(function(){MBP.coords.splice(0,2)},2500)};MBP.ghostClickHandler=function(a){if(!MBP.hadTouchEvent&&"ontouchstart"in window){a.stopPropagation();a.preventDefault();return}for(var b=0,c=MBP.coords.length;b<c;b+=2){var d=MBP.coords[b],e=MBP.coords[b+1];if(Math.abs(a.clientX-d)<25&&Math.abs(a.clientY-e)<25){a.stopPropagation();a.preventDefault()}}};a.addEventListener&&a.addEventListener("click",MBP.ghostClickHandler,!0);b(a.documentElement,"touchstart",function(){MBP.hadTouchEvent=!0},!1);MBP.coords=[];MBP.splash=function(){var b=navigator.platform==="iPad"?"h/":"l/";a.write('<link rel="apple-touch-startup-image" href="/img/'+b+'splash.png" />')};MBP.autogrow=function(a,b){function c(a){var b=this.scrollHeight,c=this.clientHeight;b>c&&(this.style.height=b+3*e+"px")}var d=b?b:12,e=a.currentStyle?a.currentStyle.lineHeight:getComputedStyle(a,null).lineHeight;e=e.indexOf("px")==-1?d:parseInt(e,10);a.style.overflow="hidden";a.addEventListener?a.addEventListener("keyup",c,!1):a.attachEvent("onkeyup",c)};MBP.enableActive=function(){a.addEventListener("touchstart",function(){},!1)};MBP.viewportMeta=$('meta[name="viewport"]');MBP.preventZoom=function(){$("input, select, textarea").bind("focus blur",function(a){MBP.viewportMeta.attr("content","width=device-width,initial-scale=1,maximum-scale="+(a.type=="blur"?10:1))})}})(document);